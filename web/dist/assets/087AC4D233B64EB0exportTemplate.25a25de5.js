/*! 
 Build based on BAIDU 
 Time : 1716207707000 */
import{s as e,a as l,r as a,P as t,o,c as u,d as r,b as n,w as d,f as s,m as i,t as m,F as p,Q as c,N as v,O as f,g as b,R as g,j as y,I as E,k as C,E as B}from"./087AC4D233B64EB0index.5fcd1422.js";import{E as h}from"./087AC4D233B64EB0drawer.6a894563.js";import"./087AC4D233B64EB0overlay.1520877c.js";/* empty css                              */import{E as V}from"./087AC4D233B64EB0input-number.f5afd020.js";/* empty css                            */import{E as _,a as j}from"./087AC4D233B64EB0select.591b7648.js";import"./087AC4D233B64EB0scrollbar.b45aa0d9.js";/* empty css                               */import{E as A}from"./087AC4D233B64EB0pagination.81705c9f.js";import{E as D,a as T}from"./087AC4D233B64EB0table-column.de1f83f6.js";import"./087AC4D233B64EB0checkbox.2864820c.js";/* empty css                                */import{a as I,E as w}from"./087AC4D233B64EB0form-item.69b26929.js";/* empty css                               */import{E as x}from"./087AC4D233B64EB0date-picker.75fecaf4.js";import{_ as N}from"./087AC4D233B64EB0warningBar.a4d9a0b0.js";import{g as k}from"./087AC4D233B64EB0autoCode.61f04816.js";import{E as U}from"./087AC4D233B64EB0index.71b3c6ca.js";import"./087AC4D233B64EB0index.c25afd12.js";import"./087AC4D233B64EB0index.d064f019.js";import"./087AC4D233B64EB0strings.84714f21.js";import"./087AC4D233B64EB0isEqual.c192b418.js";import"./087AC4D233B64EB0_Uint8Array.72188c2c.js";import"./087AC4D233B64EB0debounce.679d5750.js";import"./087AC4D233B64EB0_baseIteratee.bf25bc12.js";import"./087AC4D233B64EB0index.508774e7.js";import"./087AC4D233B64EB0castArray.ef7e3470.js";import"./087AC4D233B64EB0_initCloneObject.67d0c1fc.js";import"./087AC4D233B64EB0_baseClone.bd09a709.js";import"./087AC4D233B64EB0arrays.2c626d3b.js";const O=l=>e({url:"/sysExportTemplate/createSysExportTemplate",method:"post",data:l}),S={class:"gva-search-box"},J={class:"gva-table-box"},z={class:"gva-btn-list"},L={class:"gva-pagination"},F={class:"flex justify-between items-center"},R={class:"text-lg"},q={style:{float:"right",color:"#8492a6","font-size":"13px"}},G={class:"flex justify-end w-full"},K={class:"flex justify-end w-full"},W=Object.assign({name:"ExportTemplate"},{__name:"exportTemplate",setup(W){const H=l({name:"",tableName:"",templateID:"",templateInfo:"",limit:0,order:"",conditions:[],joinTemplate:[]}),Q=l([{label:"=",value:"="},{label:"<>",value:"<>"},{label:">",value:">"},{label:"<",value:"<"},{label:"LIKE",value:"LIKE"},{label:"BETWEEN",value:"BETWEEN"},{label:"NOT BETWEEN",value:"NOT BETWEEN"}]),P=()=>{H.value.conditions.push({from:"",column:"",operator:""})},Y=()=>{H.value.joinTemplate.push({joins:"LEFT JOIN",table:"",on:""})},Z=a({name:[{required:!0,message:"",trigger:["input","blur"]},{whitespace:!0,message:"不能只输入空格",trigger:["input","blur"]}],tableName:[{required:!0,message:"",trigger:["input","blur"]},{whitespace:!0,message:"不能只输入空格",trigger:["input","blur"]}],templateID:[{required:!0,message:"",trigger:["input","blur"]},{whitespace:!0,message:"不能只输入空格",trigger:["input","blur"]}],templateInfo:[{required:!0,message:"",trigger:["input","blur"]},{whitespace:!0,message:"不能只输入空格",trigger:["input","blur"]}]}),M=a({createdAt:[{validator:(e,l,a)=>{oe.value.startCreatedAt&&!oe.value.endCreatedAt?a(new Error("请填写结束日期")):!oe.value.startCreatedAt&&oe.value.endCreatedAt?a(new Error("请填写开始日期")):oe.value.startCreatedAt&&oe.value.endCreatedAt&&(oe.value.startCreatedAt.getTime()===oe.value.endCreatedAt.getTime()||oe.value.startCreatedAt.getTime()>oe.value.endCreatedAt.getTime())?a(new Error("开始日期应当早于结束日期")):a()},trigger:"change"}]}),X=l(),$=l(),ee=l(1),le=l(0),ae=l(10),te=l([]),oe=l({}),ue=l([]);(async()=>{const e=await k();0===e.code&&(ue.value=e.data.dbList)})();const re=()=>{oe.value={},ie()},ne=()=>{var e;null==(e=$.value)||e.validate((async e=>{e&&(ee.value=1,ae.value=10,ie())}))},de=e=>{ae.value=e,ie()},se=e=>{ee.value=e,ie()},ie=async()=>{const l=await(a={page:ee.value,pageSize:ae.value,...oe.value},e({url:"/sysExportTemplate/getSysExportTemplateList",method:"get",params:a}));var a;0===l.code&&(te.value=l.data.list,le.value=l.data.total,ee.value=l.data.page,ae.value=l.data.pageSize)};ie();(async()=>{})();const me=l([]),pe=e=>{me.value=e},ce=async()=>{g.confirm("确定要删除吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{const l=[];if(0===me.value.length)return void y({type:"warning",message:"请选择要删除的数据"});me.value&&me.value.map((e=>{l.push(e.ID)}));var a;0===(await(a={ids:l},e({url:"/sysExportTemplate/deleteSysExportTemplateByIds",method:"delete",data:a}))).code&&(y({type:"success",message:"删除成功"}),te.value.length===l.length&&ee.value>1&&ee.value--,ie())}))},ve=l(""),fe=async l=>{const a=await(t={ID:l.ID},e({url:"/sysExportTemplate/findSysExportTemplate",method:"get",params:t}));var t;ve.value="update",0===a.code&&(H.value=a.data.resysExportTemplate,H.value.conditions||(H.value.conditions=[]),H.value.joinTemplate||(H.value.joinTemplate=[]),ge.value=!0)},be=async l=>{var a;0===(await(a={ID:l.ID},e({url:"/sysExportTemplate/deleteSysExportTemplate",method:"delete",data:a}))).code&&(y({type:"success",message:"删除成功"}),1===te.value.length&&ee.value>1&&ee.value--,ie())},ge=l(!1),ye=()=>{ve.value="create",ge.value=!0},Ee=()=>{ge.value=!1,H.value={name:"",tableName:"",templateID:"",templateInfo:"",limit:0,order:"",conditions:[],joinTemplate:[]}},Ce=async()=>{var l;try{JSON.parse(H.value.templateInfo)}catch(t){return void y({type:"error",message:"模板信息格式不正确，请检查"})}const a=JSON.parse(JSON.stringify(H.value));for(let e=0;e<a.conditions.length;e++){if(!a.conditions[e].from||!a.conditions[e].column||!a.conditions[e].operator)return void y({type:"error",message:"请填写完整的导出条件"});a.conditions[e].templateID=a.templateID}for(let e=0;e<a.joinTemplate.length;e++){if(!a.joinTemplate[e].joins||!a.joinTemplate[e].on)return void y({type:"error",message:"请填写完整的关联"});a.joinTemplate[e].templateID=a.templateID}null==(l=X.value)||l.validate((async l=>{if(!l)return;let t;switch(ve.value){case"create":default:t=await O(a);break;case"update":t=await(o=a,e({url:"/sysExportTemplate/updateSysExportTemplate",method:"put",data:o}))}var o;0===t.code&&(y({type:"success",message:"创建/更改成功"}),Ee(),ie())}))};return(e,l)=>{const a=t("QuestionFilled"),y=E,k=U,O=x,W=I,ie=C,Be=B,he=w,Ve=D,_e=T,je=A,Ae=_,De=j,Te=V,Ie=h;return o(),u("div",null,[r(N,{title:"本功能提供同步的表格导出功能，大数据量的异步表格导出功能，可以选择点我定制",href:"https://flipped-aurora.feishu.cn/docx/KwjxdnvatozgwIxGV0rcpkZSn4d"}),n("div",S,[r(he,{ref_key:"elSearchFormRef",ref:$,inline:!0,model:oe.value,class:"demo-form-inline",rules:M,onKeyup:i(ne,["enter"])},{default:d((()=>[r(W,{label:"创建日期",prop:"createdAt"},{label:d((()=>[n("span",null,[s(" 创建日期 "),r(k,{content:"搜索范围是开始日期（包含）至结束日期（不包含）"},{default:d((()=>[r(y,null,{default:d((()=>[r(a)])),_:1})])),_:1})])])),default:d((()=>[r(O,{modelValue:oe.value.startCreatedAt,"onUpdate:modelValue":l[0]||(l[0]=e=>oe.value.startCreatedAt=e),type:"datetime",placeholder:"开始日期","disabled-date":e=>!!oe.value.endCreatedAt&&e.getTime()>oe.value.endCreatedAt.getTime()},null,8,["modelValue","disabled-date"]),s(" — "),r(O,{modelValue:oe.value.endCreatedAt,"onUpdate:modelValue":l[1]||(l[1]=e=>oe.value.endCreatedAt=e),type:"datetime",placeholder:"结束日期","disabled-date":e=>!!oe.value.startCreatedAt&&e.getTime()<oe.value.startCreatedAt.getTime()},null,8,["modelValue","disabled-date"])])),_:1}),r(W,{label:"模板名称",prop:"name"},{default:d((()=>[r(ie,{modelValue:oe.value.name,"onUpdate:modelValue":l[2]||(l[2]=e=>oe.value.name=e),placeholder:"搜索条件"},null,8,["modelValue"])])),_:1}),r(W,{label:"表名称",prop:"tableName"},{default:d((()=>[r(ie,{modelValue:oe.value.tableName,"onUpdate:modelValue":l[3]||(l[3]=e=>oe.value.tableName=e),placeholder:"搜索条件"},null,8,["modelValue"])])),_:1}),r(W,{label:"模板标识",prop:"templateID"},{default:d((()=>[r(ie,{modelValue:oe.value.templateID,"onUpdate:modelValue":l[4]||(l[4]=e=>oe.value.templateID=e),placeholder:"搜索条件"},null,8,["modelValue"])])),_:1}),r(W,null,{default:d((()=>[r(Be,{type:"primary",icon:"search",onClick:ne},{default:d((()=>[s("查询")])),_:1}),r(Be,{icon:"refresh",onClick:re},{default:d((()=>[s("重置")])),_:1})])),_:1})])),_:1},8,["model","rules"])]),n("div",J,[n("div",z,[r(Be,{type:"primary",icon:"plus",onClick:ye},{default:d((()=>[s("新增")])),_:1}),r(Be,{icon:"delete",style:{"margin-left":"10px"},disabled:!me.value.length,onClick:ce},{default:d((()=>[s("删除")])),_:1},8,["disabled"])]),r(_e,{ref:"multipleTable",style:{width:"100%"},"tooltip-effect":"dark",data:te.value,"row-key":"ID",onSelectionChange:pe},{default:d((()=>[r(Ve,{type:"selection",width:"55"}),r(Ve,{align:"left",label:"日期",width:"180"},{default:d((e=>[s(m(p(c)(e.row.CreatedAt)),1)])),_:1}),r(Ve,{align:"left",label:"数据库",prop:"name",width:"120"},{defalut:d((e=>[n("span",null,m(e.row.dbNname||"GVA库"),1)])),_:1}),r(Ve,{align:"left",label:"模板名称",prop:"name",width:"120"}),r(Ve,{align:"left",label:"表名称",prop:"tableName",width:"120"}),r(Ve,{align:"left",label:"模板标识",prop:"templateID",width:"120"}),r(Ve,{align:"left",label:"模板信息",prop:"templateInfo","min-width":"120"}),r(Ve,{align:"left",label:"操作","min-width":"120"},{default:d((e=>[r(Be,{type:"primary",link:"",icon:"edit",class:"table-button",onClick:l=>fe(e.row)},{default:d((()=>[s("变更")])),_:2},1032,["onClick"]),r(Be,{type:"primary",link:"",icon:"delete",onClick:l=>{return a=e.row,void g.confirm("确定要删除吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{be(a)}));var a}},{default:d((()=>[s("删除")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"]),n("div",L,[r(je,{layout:"total, sizes, prev, pager, next, jumper","current-page":ee.value,"page-size":ae.value,"page-sizes":[10,30,50,100],total:le.value,onCurrentChange:se,onSizeChange:de},null,8,["current-page","page-size","total"])])]),r(Ie,{modelValue:ge.value,"onUpdate:modelValue":l[12]||(l[12]=e=>ge.value=e),size:"60%","before-close":Ee,title:"create"===ve.value?"添加":"修改","show-close":!1,"destroy-on-close":""},{header:d((()=>[n("div",F,[n("span",R,m("create"===ve.value?"添加":"修改"),1),n("div",null,[r(Be,{onClick:Ee},{default:d((()=>[s("取 消")])),_:1}),r(Be,{type:"primary",onClick:Ce},{default:d((()=>[s("确 定")])),_:1})])])])),default:d((()=>[r(he,{ref_key:"elFormRef",ref:X,model:H.value,"label-position":"right",rules:Z,"label-width":"100px"},{default:d((()=>[r(W,{label:"业务库",prop:"dbName"},{label:d((()=>[r(k,{content:"注：需要提前到db-list自行配置多数据库，如未配置需配置后重启服务方可使用。若无法选择，请到config.yaml中设置disabled:false，选择导入导出的目标库。",placement:"bottom",effect:"light"},{default:d((()=>[n("div",null,[s(" 业务库 "),r(y,null,{default:d((()=>[r(a)])),_:1})])])),_:1})])),default:d((()=>[r(De,{modelValue:H.value.dbName,"onUpdate:modelValue":l[5]||(l[5]=e=>H.value.dbName=e),clearable:"",placeholder:"选择业务库"},{default:d((()=>[(o(!0),u(v,null,f(ue.value,(e=>(o(),b(Ae,{key:e.aliasName,value:e.aliasName,label:e.aliasName,disabled:e.disable},{default:d((()=>[n("div",null,[n("span",null,m(e.aliasName),1),n("span",q,m(e.dbName),1)])])),_:2},1032,["value","label","disabled"])))),128))])),_:1},8,["modelValue"])])),_:1}),r(W,{label:"模板名称:",prop:"name"},{default:d((()=>[r(ie,{modelValue:H.value.name,"onUpdate:modelValue":l[6]||(l[6]=e=>H.value.name=e),clearable:!0,placeholder:"请输入模板名称"},null,8,["modelValue"])])),_:1}),r(W,{label:"表名称:",prop:"tableName"},{default:d((()=>[r(ie,{modelValue:H.value.tableName,"onUpdate:modelValue":l[7]||(l[7]=e=>H.value.tableName=e),clearable:!0,placeholder:"请输入要导出的表名称"},null,8,["modelValue"])])),_:1}),r(W,{label:"模板标识:",prop:"templateID"},{default:d((()=>[r(ie,{modelValue:H.value.templateID,"onUpdate:modelValue":l[8]||(l[8]=e=>H.value.templateID=e),clearable:!0,placeholder:"模板标识为前端组件需要挂在的标识属性"},null,8,["modelValue"])])),_:1}),r(W,{label:"关联条件:"},{default:d((()=>[(o(!0),u(v,null,f(H.value.joinTemplate,((e,l)=>(o(),u("div",{key:l,class:"flex gap-4 w-full mb-2"},[r(De,{modelValue:e.joins,"onUpdate:modelValue":l=>e.joins=l,placeholder:"请选择关联方式"},{default:d((()=>[r(Ae,{label:"LEFT JOIN",value:"LEFT JOIN"}),r(Ae,{label:"INNER JOIN",value:"INNER JOIN"}),r(Ae,{label:"RIGHT JOIN",value:"RIGHT JOIN"})])),_:2},1032,["modelValue","onUpdate:modelValue"]),r(ie,{modelValue:e.table,"onUpdate:modelValue":l=>e.table=l,placeholder:"请输入关联表"},null,8,["modelValue","onUpdate:modelValue"]),r(ie,{modelValue:e.on,"onUpdate:modelValue":l=>e.on=l,placeholder:"关联条件 table1.a = table2.b"},null,8,["modelValue","onUpdate:modelValue"]),r(Be,{type:"danger",icon:"delete",onClick:()=>H.value.joinTemplate.splice(l,1)},{default:d((()=>[s("删除")])),_:2},1032,["onClick"])])))),128)),n("div",G,[r(Be,{type:"primary",icon:"plus",onClick:Y},{default:d((()=>[s("添加条件")])),_:1})])])),_:1}),r(W,{label:"模板信息:",prop:"templateInfo"},{default:d((()=>[r(ie,{modelValue:H.value.templateInfo,"onUpdate:modelValue":l[9]||(l[9]=e=>H.value.templateInfo=e),type:"textarea",rows:12,clearable:!0,placeholder:'模板信息格式：key标识数据库column列名称（在join模式下需要写为 table.column），value标识导出excel列名称，如下：\n{\n  "table_column1":"第一列",\n  "table_column2":"第二列",\n  "table_column3":"第三列",\n  "table_column4":"第四列",\n}\n如果增加了JOINS导出key应该列为 {table_name1.table_column1:"第一列",table_name2.table_column2:"第二列"}\nJOINS模式下不支持导入\n'},null,8,["modelValue"])])),_:1}),r(W,{label:"默认导出条数:"},{default:d((()=>[r(Te,{modelValue:H.value.limit,"onUpdate:modelValue":l[10]||(l[10]=e=>H.value.limit=e),step:1,"step-strictly":!0,precision:0},null,8,["modelValue"])])),_:1}),r(W,{label:"默认排序条件:"},{default:d((()=>[r(ie,{modelValue:H.value.order,"onUpdate:modelValue":l[11]||(l[11]=e=>H.value.order=e),placeholder:"例:id desc"},null,8,["modelValue"])])),_:1}),r(W,{label:"导出条件:"},{default:d((()=>[(o(!0),u(v,null,f(H.value.conditions,((e,l)=>(o(),u("div",{key:l,class:"flex gap-4 w-full mb-2"},[r(ie,{modelValue:e.from,"onUpdate:modelValue":l=>e.from=l,placeholder:"需要从查询条件取的json key"},null,8,["modelValue","onUpdate:modelValue"]),r(ie,{modelValue:e.column,"onUpdate:modelValue":l=>e.column=l,placeholder:"表对应的column"},null,8,["modelValue","onUpdate:modelValue"]),r(De,{modelValue:e.operator,"onUpdate:modelValue":l=>e.operator=l,placeholder:"请选择查询条件"},{default:d((()=>[(o(!0),u(v,null,f(Q.value,(e=>(o(),b(Ae,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue"]),r(Be,{type:"danger",icon:"delete",onClick:()=>H.value.conditions.splice(l,1)},{default:d((()=>[s("删除")])),_:2},1032,["onClick"])])))),128)),n("div",K,[r(Be,{type:"primary",icon:"plus",onClick:P},{default:d((()=>[s("添加条件")])),_:1})])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue","title"])])}}});export{W as default};
